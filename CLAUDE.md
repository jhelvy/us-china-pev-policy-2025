# Claude Code - US-China PEV Policy 2025

This repository contains replication code and data for the article:

> Helveston, John P. (2025) "How collaboration with China can revitalize US automotive innovation" _Science_. 390(6772). DOI: [10.1126/science.adz0541](https://doi.org/10.1126/science.adz0541)

## Repository Overview

This is an R-based analysis using the tidyverse ecosystem. The code reproduces two key figures from the article comparing battery electric vehicle (BEV) prices and ranges between the US and China.

### Key Files

- **`fig1-range-price.R`**: Generates Figure 1 showing price vs. range scatter plots for 2024 BEVs by vehicle class (Car, SUV, Pickup Truck). Includes adjusted versions accounting for different testing cycles (EPA vs. CLTC).
- **`figs1-china-sales.R`**: Generates Figure S1 showing annual Chinese BEV sales data.
- **`data/`**: Raw data files including `car_specs_china.parquet` and `car_specs_us.parquet`.
- **`data_processed/`**: Processed data files ready for visualization.
- **`figs/`**: Output directory for generated figures (PNG and PDF formats).

### Main Figure 1 Analysis

Figure 1 compares 2024 BEV models across three vehicle classes:
- **X-axis**: Driving range in miles
- **Y-axis**: Price in USD
- **Colors**: China (red) vs. USA (blue)

Key findings:
- China offers more affordable BEVs across all range categories
- Chinese BEVs achieve longer ranges at lower price points

### Range Adjustment

The code includes two adjusted versions to account for different testing cycles:

1. **EPA adjusted**: Reduces Chinese BEV ranges by 30% (`range / 1.3`) to approximate EPA testing
2. **CLTC adjusted**: Increases US BEV ranges by 30% (`range * 1.3`) to approximate CLTC testing

This is necessary because:
- US uses 5-cycle EPA testing
- China uses CLTC testing (tends to over-estimate range compared to EPA)

### Running the Code

To reproduce Figure 1:

```r
# Install required packages
install.packages(c("tidyverse", "cowplot", "arrow", "ggtext", "ggrepel"))

# Run the script
source("fig1-range-price.R")
```

The script will:
1. Load and clean US and China BEV data
2. Combine datasets
3. Generate three versions of Figure 1:
   - `fig1-range-price.png` (original)
   - `fig1-range-price-adjusted-epa.png` (China ranges reduced)
   - `fig1-range-price-adjusted-cltc.png` (US ranges increased)

### Interactive Shiny App

An interactive Shiny app is available to explore Figure 1 with adjustable range factors:

```r
# Install shiny if needed
install.packages("shiny")

# Run the app
shiny::runApp("app.R")
```

The app allows you to:
- Adjust the range conversion percentage interactively (slider from 0% to 50%)
- Choose which country's ranges to adjust (EPA or CLTC)
- See real-time updates to the scatter plot

The app reads preprocessed data from `data_processed/fig1-range-price.csv`, which is generated by running `fig1-range-price.R`.

### Data Structure

Both datasets follow this structure after processing:
- `vehicle`: Vehicle name (brand + model)
- `model`: Model name
- `model_year`: Year (filtered to 2024 for main analysis)
- `range_mi`: Driving range in miles
- `price`: Price in thousands of USD
- `powertrain`: BEV or PHEV
- `country`: China or USA
- `class`: Car, SUV, or Pickup Truck
- `target_model`: Boolean for labeled vehicles in plots

### Key Dependencies

- **tidyverse**: Data manipulation and ggplot2 for visualization
- **arrow**: Reading parquet files
- **cowplot**: Enhanced plot themes
- **ggtext**: Markdown text rendering in plots
- **ggrepel**: Smart label positioning
- **shiny**: Interactive web application

### Conversions Used

- `km_per_mi = 1.6`
- `dollars_per_rmb = 0.14`

### Citation

If using this repository, please cite:

[![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.16878932.svg)](https://doi.org/10.5281/zenodo.16878932)
